{{ define "title" }} - Simulator{{ end }}

{{ define "scripts" }}
<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script src="/static/js/simulator/globals.js"></script>
<script src="/static/js/lib/physicsjs/physicsjs-full.js"></script>
<script src="/static/js/lib/eq-solver.js"></script>
<script src="/static/js/simulator/simulation.js"></script>
<script src="/static/js/simulator/ui-controller.js"></script>
<script src="/static/js/simulator/rendering.js"></script>
<script src="/static/js/simulator/utility.js"></script>
<script src="/static/js/simulator/components/origin.js"></script>
<script src="/static/js/simulator/components/mass.js"></script>
<script src="/static/js/simulator/components/surface.js"></script>
<script src="/static/js/simulator/components/ramp.js"></script>
<script src="/static/js/simulator/components/spring.js"></script>
<script src="/static/js/simulator/components/pulley.js"></script>
<script src="/static/js/simulator/modules/kinematics.js"></script>
<script src="/static/js/lib/canvasjs.min.js"></script>

<script>
  Kinematics1D.initModule({{ .Data.simulation.Simulator }});
  var GlobalKeyNames = {
    User: {{ .User.KeyName }},
    Simulation: {{ .Data.simulation.KeyName }},
  }
</script>

<script src="/static/js/simulator/base.js"></script>
<script src="/static/js/forms.js"></script>
<script src="/static/js/view.js"></script>
{{ end }}


{{ define "content" }}

{{ if and (.IsLoggedIn) (.Data.isOwner) }} <!-- The navbar for a logged in owner -->
  <nav id="simulator-subnav" role="navigation">
    <ul class="left nav-wrapper">
      <li><a href="/simulator/kinematics"><i class="fa fa-file-o fa-size-small"></i> Fresh</a></li>
      {{ if not .Data.new }}
      <li class="clickable"><a id="delete-button"
        onclick="deleteSimulation('/simulator/{{ .Data.simulation.Type }}/{{ .Data.simulation.KeyName }}', '/simulator/{{ .Data.simulation.Type }}', null)">
          <i class="fa fa-trash fa-size-small"></i> Delete
        </a>
      </li>
      {{ end }}
      <li class="clickable" onclick="saveSimulation({{ .Data.imageUploadUrl }})"><i class="fa fa-save fa-size-small"></i> Save</li>
      <li>
        <div class="switch">
          <label>
            Public
            {{ if .Data.simulation.IsPrivate }}
              <input id="simulation-is-private" checked="true" type="checkbox">
            {{ else }}
              <input id="simulation-is-private" type="checkbox">
            {{ end }}
            <span class="lever"></span>
            Private
          </label>
        </div>
      </li>
      <li> 
        {{ if .Data.new }}
          <input id="simulation-name" type="text" value="New Simulation"></input>
        {{ else }}
          <input id="simulation-name" type="text" value="{{ .Data.simulation.Name }}"></input>
        {{ end }}
      </li>
      <li class="clickable right"><i class="fa fa-question fa-size-small"></i></li>
      {{ if not .Data.new }}
      <li class="right">
        <span id="ratings" class="tooltipped" data-position="left" data-delay="50" data-tooltip="Loading Stars...">
          <i class="fa fa-star waves-effect waves-light grey-text text-lighten-1"></i>
        </span>
      </li>
      {{ end }}
    </ul>
  </nav>
{{ else }} <!-- The normal navbar -->
  <nav id="simulator-subnav" role="navigation">
    <ul class="left nav-wrapper">
      <li><a href="/simulator/kinematics"><i class="fa fa-file-o fa-size-small"></i> Fresh</a></li>
      <li> 
        {{ if .Data.new }}
          <p>New Simulation</p>
        {{ else }}
          <p>{{ .Data.simulation.Name }}</p>
        {{ end }}
      </li>
      {{ if not .Data.new }}
        <li>
          <p>By: <a href="/user/{{ .Data.simulation.AuthorID }}">{{ .Data.simulation.AuthorName }}</a></p>
        </li>
      {{ end }}
      <li class="clickable right"><i class="fa fa-question fa-size-small"></i></li>
      {{ if and (not .Data.new) (.IsLoggedIn) }}
      <li class="right">
        <span id="rating" class="tooltipped left" data-position="left" data-delay="50" data-tooltip="Loading Stars...">
          <a onclick="saveRating()"><i id="star-icon" class="fa fa-star-o waves-effect waves-light yellow-text text-accent-4"></i></a>
        </span>
      </li>
      {{ end }}
    </ul>
  </nav>
{{ end }}

<div class="row" id="menu-row">
  <div id="left-menu">
    <ul>
      <li class="clickable left-menu-item"><span class="blue-text valign" id="prompt-tab"><i class="fa fa-pencil-square-o fa-size-medium"></i> <small>Description</small></span></li>
      <li class="clickable left-menu-item"><span class="blue-text valign" id="keyframes-tab"><i class="fa fa-key fa-size-medium"></i> <small>Keyframes</small></span></li>
      <li class="clickable left-menu-item"><span class="blue-text valign" id="graphs-tab"><i class="fa fa-line-chart fa-size-medium"></i> <small>Graphs</small></span></li>
    </ul>
  </div>

  <div id="right-menu">
    <ul>
      <li class="clickable right-menu-item"><span class="blue-text valign" id="toolbox-tab"><i class="fa fa-cubes fa-size-medium"></i> <small>Toolbox</small></span></li>
      <li class="clickable right-menu-item"><span class="blue-text valign" id="elementprops-tab"><i class="fa fa-info-circle fa-size-medium"></i> <small>Properties</small></span></li>
      <li class="clickable right-menu-item"><span class="blue-text valign" id="globalprops-tab"><i class="fa fa-globe fa-size-medium"></i> <br/><small>Global</small></span></li>
      <li class="clickable right-menu-item"><span class="blue-text valign" id="overview-tab"><i class="fa fa-list fa-size-medium"></i> <small>Overview</small></span></li>
    </ul>
  </div>

  <div id="simulator-window">
    <div id="viewport"></div>
    <div class="zoom-controls-container">
      <div class="zoom-controls">
        <a id="zoom-control-in" class="waves-effect waves-light btn brown lighten-5 black-text"><i class="fa fa-plus"></i></a>
        <a id="zoom-control-out" class="waves-effect waves-light btn brown lighten-5 black-text"><i class="fa fa-minus"></i></a>
      </div>
    </div>
  </div>
</div>

<div class="row" id="menu-row">
  <div id="play-container">
    <div id="play-button">
      <button type="button" class="waves-effect waves-light btn-floating blue darken-1" id="playpause">
        <span aria-hidden="true"><i id="play-pause-icon" class="fa fa-play fa-size-tiny"></i></span>
      </button>
    </div>
    <div class="calculated-width" id="play-range">
      <input type="range" min="0" max="3999" step="1" value="0" id="simulatorFrameRange" oninput="onRangeUpdate()" />
    </div>
  </div>
</div>

{{ if .Data.simulation.KeyName }}
  <div class="main-container simulator-container" id="comments-frag">
    {{ template "commentsFrag" . }}
  </div>
{{ end }}












<!-- Initially hidden elements -->

<!--prompt-->
<div id="prompt" class = "center-align card-panel">
  <h5 class="pad-sides">Prompt</h5>
  <div class="input-field">
    <textarea id="textarea1" class="materialize-textarea"></textarea>
    <label for="textarea1">Textarea</label>
  </div>
</div>

<!--keyframes-->
<div id="keyframes-slide" class = "center-align card-panel">
  <h5 class="pad-sides">Keyframes</h5>

  <div class="help-tooltip-container">
    <div class="row">
      <a id="solution-detail-button" class="waves-effect waves-light btn modal-trigger purple darken-1" href="#solutionModal" style="display: none;">Solution Details</a>
      <h5>Keyframes:
        <a class="btn-floating btn-small waves-effect waves-light red" id="add-keyframe"><i class="fa fa-plus"></i></a>
        <!-- Solution Modal Trigger -->
      </h5>
    </div>
    <div id="help-tooltip-keyframes" class="help-tooltip card">
      <p>
        Multiple keyframes are used to set up the initial and final states of your model so
        that the frames inbetween can be solved for. You can even set up intermediate key
        frames. The solution will display in the "Solution Details" window.
      </p>
    </div>
  </div>


  <div id="keyframelist">
    <ul id="keyframe-list">
      <li>
        <div class="keyframe-tile">
          <h6>Frame 1: </h6>
          <canvas id="keyframe-0" class="keyframe" style="border:4px solid #0000cc"></canvas>
          <div class="input-field">
            <input id="keyframe-0-dt" type="text" readonly value="0"></input>
            <label for="keyframe-0-dt" class="active">dt</label>
          </div>
        </div>
      </li>
    </ul>
  </div>
  
</div>

<!--graph-->
<div id="graphs-slide" class = "center-align card-panel">
  <h5 class="pad-sides">Graphs</h5>
  <!-- Graphing acceleration velocity and position -->

    <div id="pvaGraphContainer">
      <ul class="collapsible" data-collapsible="expandable">
        <li>
          <div class="collapsible-header active"><i class="material-icons"></i>Position</div>
          <div class="collapsible-body">
            <div id="positionGraph"></div>
          </div>
          
        </li>
        <li>
          <div class="collapsible-header active"><i class="material-icons"></i>Velocity/Acceleration</div>
          <div class="collapsible-body" >
            <div id ="vaGraph"></div>
          </div>
        </li>
      </ul>
    </div>
</div>

<!-- Toolbox -->
    <div id="toolbox" class="z-depth-2 center-align">
      <div class="center-align">
        <h5 class="pad-sides">Toolbox</h5>
        <ul class="property-window-list">
          <li class="toolbox-item-container card" title="Point Mass">
            <span class="activator clickable toolbox-tooltip"><i class="fa fa-question-circle fa-size-tiny"></i></span>
            <div class="valign-wrapper">
              <img class="toolbox-item draggable clickable responsive-img valign" width="100" src="/static/img/toolbox/roundmass.png" component="kinematics1D-roundmass"/>
            </div>
            <div class="card-reveal">
              <span class="card-title clickable left"><i class="fa fa-times fa-size-tiny"></i></span>
              <p>Point Masses are the staple of Principia. They can be given velocity, acceleration, mass, size, or drawn with different images.</p>
            </div>
          </li>
          <li class="toolbox-item-container card" title="Point Mass">
            <span class="activator clickable toolbox-tooltip"><i class="fa fa-question-circle fa-size-tiny"></i></span>
            <div class="valign-wrapper">
              <img class="toolbox-item draggable clickable responsive-img valign" width="100" src="/static/img/toolbox/squaremass.png" component="kinematics1D-squaremass"/>
            </div>
            <div class="card-reveal">
              <span class="card-title clickable left"><i class="fa fa-times fa-size-tiny"></i></span>
              <p>Point Masses are the staple of Principia. They can be given velocity, acceleration, mass, size, or drawn with different images.</p>
            </div>
          </li>
          <li class="toolbox-item-container card" title="Ramp">
            <span class="activator clickable toolbox-tooltip"><i class="fa fa-question-circle fa-size-tiny"></i></span>
            <div class="valign-wrapper">
              <img class="toolbox-item draggable clickable responsive-img valign" width="100" src="/static/img/toolbox/ramp.png" component="kinematics1D-ramp"/>
            </div>
            <div class="card-reveal">
              <span class="card-title clickable left"><i class="fa fa-times fa-size-tiny"></i></span>
              <p>Ramps are static and affect the movement of point mass objects.</p>
            </div>
          </li>
          <li class="toolbox-item-container card" title="Spring">
            <span class="activator clickable toolbox-tooltip"><i class="fa fa-question-circle fa-size-tiny"></i></span>
            <div class="valign-wrapper">
              <img class="toolbox-item draggable clickable responsive-img valign" width="100" src="/static/img/toolbox/spring.png" component="kinematics1D-spring"/>
            </div>
            <div class="card-reveal">
              <span class="card-title clickable left"><i class="fa fa-times fa-size-tiny"></i></span>
              <p>Attatch a point mass to the right end of a spring to see it in action.</p>
            </div>
          </li>
          <!-- Pulley
          <li class="toolbox-item-container card" title="Pulley">
            <span class="activator clickable toolbox-tooltip"><i class="fa fa-question-circle fa-size-tiny"></i></span>
            <div class="valign-wrapper">
              <img class="toolbox-item draggable clickable responsive-img valign" width="100" src="/static/img/toolbox/pulley.png" component="kinematics1D-pulley"/>
            </div>
            <div class="card-reveal">
              <span class="card-title clickable left"><i class="fa fa-times fa-size-tiny"></i></span>
              <p>Drag two point mass objects into a pulley to attach them. Then drag one below, give them weights, set gravity and give it a whirl.</p>
            </div>
          </li> -->
          <!-- Rope
            <li class="toolbox-item-container card" title="Rope">
              <span class="activator clickable toolbox-tooltip"><i class="fa fa-question-circle fa-size-tiny"></i></span>
              <div class="valign-wrapper">
                <img class="toolbox-item draggable clickable responsive-img valign" width="100" src="/static/img/toolbox/rope.png" component="kinematics1D-rope"/>
              </div>
              <div class="card-reveal">
                <span class="card-title clickable left"><i class="fa fa-times fa-size-tiny"></i></span>
                <p>These are currently in progress of being added.</p>
              </div>
            </li>
          -->
        </ul>
      </div>
      <div class="clear"></div>
    </div>




    <!-- Properties window for each element -->
    <div id="elementprops">
      <div class="center-align ">
        <h5 class="pad-sides"><span id="general-properties-nickname-title"></span>Element Properties</h5>

        <!-- Properties that apply to all components -->
        <ul class="property-window-list hide" id="general-properties">
          <li class="property-item">
            <div class="input-field">
              <input type="text" id="general-properties-nickname" placeholder=""></input>
              <label for="general-properties-nickname" class="active">Nickname</label>
            </div>
          </li>
          <li class="property-item">
            <div class="input-field">
              <a class="waves-effect waves-light btn red darken-1" onclick="deleteBody()"> <i class="fa fa-trash"></i></a>
            </div>
          </li>
          <li class="property-item" principia-property="posx">
            <div class="input-field">
              <input type="number" id="general-properties-position-x" placeholder="" title="Enter a number"></input>
              <label for="general-properties-position-x" class="active" id="x-position-label">X Position</label>
            </div>            
          </li>
          <li class="property-item" principia-property="posy">
            <div class="input-field">
              <input type="number" id="general-properties-position-y" placeholder="" title="Enter a number"></input>
              <label for="general-properties-position-y" class="active" id="y-position-label">Y Position</label>
            </div>            
          </li>
        </ul>

        <!-- Properties that apply to point mass components -->
        <ul class="property-window-list hide" id="pointmass-properties">
          <li class="property-item" principia-property="velx">
            <div class="input-field">
              <input type="number" id="pointmass-properties-velocity-x" placeholder="" title="Enter a number"></input>
              <label for="pointmass-properties-velocity-x" class="active" id="x-velocity-label">X Velocity</label>
            </div>            
          </li>
          <li class="property-item" principia-property="vely">
            <div class="input-field">
              <input type="number" id="pointmass-properties-velocity-y" placeholder="" title="Enter a number"></input>
              <label for="pointmass-properties-velocity-y" class="active" id="y-velocity-label">Y Velocity</label>
            </div>            
          </li>
          <li class="property-item" principia-property="accx">
            <div class="input-field">
              <input type="number" id="pointmass-properties-acceleration-x" placeholder="" title="Enter a number"></input>
              <label for="pointmass-properties-acceleration-x" class="active" id="x-acceleration-label">X Acceleration</label>
            </div>            
          </li>
          <li class="property-item" principia-property="accy">
            <div class="input-field">
              <input type="number" id="pointmass-properties-acceleration-y" placeholder="" title="Enter a number"></input>
              <label for="pointmass-properties-acceleration-y" class="active" id="y-acceleration-label">Y Acceleration</label>
            </div>            
          </li>
          <li class="property-item">
            <div class="input-field">
              <input type="number" id="pointmass-properties-mass" placeholder="" title="Enter a number"></input>
              <label for="pointmass-properties-mass" class="active">Mass</label>
            </div>
          </li>
          <li class="property-item">
            <div class="input-field">
              <input type="text" id="pointmass-properties-size" placeholder=""></input>
              <label for="pointmass-properties-size" class="active">Size</label>
            </div>
          </li>
          <li class="property-item">
            <div class="input-field">
              <select id="pointmass-properties-img" class="browser-default">
                <option disabled>Display As:</option>
                <option value="0" selected="selected">Mass</option>
                <option value="1">Weight</option>
                <option value="2">Car</option>
                <option value="3">Sail Boat</option>
                <option value="4">Speed Boat</option>
                <option value="5">Mascot</option>
                <option value="6">Dart</option>
                <option value="7">Jogger</option>
                <option value="8">Rocket</option>
                <option value="9">Dalton</option>
                <option value="10">Danny</option>
                <option value="11">Matthew</option>
                <option value="12">Sam</option>
                <option value="13">Logo</option>
              </select>
              <label for="pointmass-properties-img" class="active">Display As</label>
            </div>
          </li>
          <li class="property-item">
            <div class="input-field">
              <span>Vectors</span>
              <div class="switch">
                <label>
                  Off
                  <input class="vector-toggle" id="pointmass-properties-vector" type="checkbox" checked="checked"></input>
                  <span class="lever"></span>
                  On
                </label>
              </div>
            </div>
          </li>
          <li class="property-item">
            <div class="input-field">
              <span>Tip-to-Tail Vectors</span>
              <div class="switch">
                <label>
                  Off
                  <input class="ttt-toggle" id="pointmass-properties-vector-ttt" type="checkbox"></input>
                  <span class="lever"></span>
                  On
                </label>
              </div>
            </div>
          </li>
          <li class="property-item">
            <div class="input-field">
              <span>PVA Graph</span>
              <div class="switch">
                <label>
                  Off
                  <input class="pvagraph-toggle" id="pointmass-properties-pvagraph" type="checkbox"></input>
                  <span class="lever"></span>
                  On
                </label>
              </div>
            </div>
          </li>
        </ul>

        <!-- Ramp properties! -->
        <ul class="property-window-list hide" id="ramp-properties">
          <li class="property-item">
            <div class="input-field">
              <input type="number" id="ramp-properties-width" placeholder="" title="Enter a number"></input>
              <label for="ramp-properties-width" class="active">Width</label>
            </div>
          </li>
          <li class="property-item">
            <div class="input-field">
              <input type="number" id="ramp-properties-height" placeholder="" title="Enter a number"></input>
              <label for="ramp-properties-height" class="active">Height</label>
            </div>
          </li>
          <li class="property-item">
            <div class="input-field">
              <input type="number" id="ramp-properties-angle" placeholder="" title="Enter a number"></input>
              <label for="ramp-properties-angle" class="active">Slope as Angle º</label>
            </div>
          </li>
          <li class="property-item">
            <div class="input-field">
              <input type="number" id="ramp-properties-friction" placeholder="" title="Enter a number"></input>
              <label for="ramp-properties-friction" class="active">Friction</label>
            </div>
          </li>
          <li class="property-item">
            <div class="input-field">
              <a class="waves-effect waves-light btn" id="ramp-properties-flip-horz">Flip Horz.</a>
            </div>
          </li>          
          <li class="property-item">
            <div class="input-field">
              <a class="waves-effect waves-light btn" id="ramp-properties-flip-vert">Flip Vert.</a>
            </div>
          </li>
        </ul>
      </div>
    </div>




<!-- Hideable global properties window for each element -->
    <div id="globalprops">
      <div class="center-align ">
        <h5 class="pad-sides principia-blue-color pad-title">Global Properties</h5>
        <div class="row">
          <div class="input-field col s6">
            <input type="number" id="glob-xaccel" placeholder="" title="Enter a number"></input>
            <label for="glob-xaccel" class="active">Horizontal Acceleration</label>
          </div>
          <div class="input-field col s6">
            <input type="number" id="glob-yaccel" placeholder="" title="Enter a number"></input>
            <label for="glob-yaccel" class="active">Vertical Acceleration</label>
          </div>
        </div>
        <div class="row">
          <div class="input-field col s6">
            <select id="coord-sys" class="browser-default">
              <option disabled>Coordinate System:</option>
              <option value="cartesian" selected="selected">Cartesian</option>
              <option value="polar" >Polar</option>
            </select>
            <label for="coord-sys" class="active">Coordinate System</label>
          </div>
        </div>
        
        <div class="row">
          <div class="input-field col s6">
            <select id="glob-length-unit" class="browser-default">
              <option disabled>Length Unit</option>
              <option value="1000.0" >Millimeters</option>
              <option value="100.0" >Centimeters</option>
              <option value="1.0" selected="selected">Meters</option>
              <option value="0.001" >Kilometers</option>
              <option value="39.3701" >Inches</option>
              <option value="3.28084" >Feet</option>
              <option value="1.09361" >Yards</option>
              <option value="0.000621371" >Miles</option>
            </select>
            <label for="glob-length-unit" class="active">Length Unit</label>
          </div>
          <div class="input-field col s6">
            <select id="glob-time-unit" class="browser-default">
              <option disabled>Time Unit</option>
              <option value="1000.0" >Milliseconds</option>
              <option value="1.0" selected="selected">Seconds</option>
              <option value="0.01666666667" >Minutes</option>
              <option value="0.00027777778" >Hours</option>
            </select>
            <label for="glob-time-unit" class="active">Time Unit</label>
          </div>
        </div>
        
        <div class="row">
          <div class="col s5">
            <div class="toolbox-item-container card" title="Origin">
              <span class="activator clickable toolbox-tooltip"><i class="fa fa-question-circle fa-size-tiny"></i></span>
              <div class="valign-wrapper">
                <img class="toolbox-item ui-draggable clickable responsive-img valign" width="100" src="/static/img/toolbox/target.png"/>
              </div>
              <div class="card-reveal">
                <span class="card-title clickable left"><i class="fa fa-times fa-size-tiny"></i></span>
                <p>Change the origin of the simulation!</p>
              </div>
            </div>
          </div>

          <div class="input-field col s3">
            <input type="number" id="glob-xorigin" placeholder="" value="0" title="Enter a number"></input>
            <label for="glob-xorigin" class="active">Origin X</label>
          </div>
          <div class="input-field col s3">
            <input type="number" id="glob-yorigin" placeholder="" value="0" title="Enter a number"></input>
            <label for="glob-yorigin" class="active">Origin Y</label>
          </div>
        </div>
      </div>
    </div>




<!-- Overview with a dynamically populated list of all active elements -->
    <div id="overview">
      <div class="center-align ">
        <h5 class="pad-sides">Scene Overview</h5>
        <div class="row" >
          <ul id ="overview-list"></ul>
        </div>
      </div>
    </div>
  </div>
  <div class="help-tooltip-container">
    <div id="help-tooltip-simulator" class="help-tooltip card">
      <p>Drag any component from the toolbox into the simulator, select it, give it some velocity, then click play!</p>
    </div>
    <div id="help-tooltip-properties" class="help-tooltip card">
      <p>Navigate between the Toolbox, the Element Properties, the Global Properties, and the Overview panels.</p>
    </div>
    <div id="help-tooltip-toolbox" class="help-tooltip card">
      <p>Drag any of the desired components above into the simulator!</p>
    </div>
  </div>
</div>
<!---------- End Simulator and property window  ---------->


{{ end }}
